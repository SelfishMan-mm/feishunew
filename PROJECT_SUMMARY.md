# 飞书多维表格跨表复制工具

一个基于 PersonalBaseToken 认证的飞书多维表格数据复制工具，支持跨表格的数据迁移和字段类型自动转换。

## 🎯 核心功能

- **🔐 PersonalBaseToken 认证** - 独立认证，无需复杂的应用配置
- **📊 智能字段映射** - 自动匹配同名字段，支持类型转换
- **🔄 批量数据复制** - 支持大量数据的分页复制
- **🧪 测试和调试** - 单条复制测试、源数据分析、字段匹配调试
- **🎨 现代化UI** - 卡片式设计，专业蓝色配色方案
- **⚡ 实时进度** - 复制过程可视化监控

## 📁 项目结构

```
/
├── api/                    # 后端API接口
│   ├── copy.js            # 主复制功能
│   ├── test-copy.js       # 单条测试复制
│   ├── debug-source.js    # 源表数据调试
│   ├── debug-fields.js    # 字段匹配调试
│   ├── test-auth.js       # 授权测试
│   ├── tables.js          # 表格列表获取
│   └── fields.js          # 字段操作
├── public/
│   └── index.html         # 前端主界面
├── package.json           # 项目依赖
├── vercel.json           # Vercel 部署配置
└── README.md             # 项目文档
```

## 🚀 快速开始

### 1. 环境要求

- Node.js 16+
- npm 或 yarn

### 2. 安装依赖

```bash
npm install
```

### 3. 本地运行

```bash
# 开发环境
npm run dev

# 生产环境
npm start
```

### 4. 获取 PersonalBaseToken

1. 访问[飞书开放平台](https://open.feishu.cn)
2. 进入"个人设置" > "个人访问令牌"
3. 创建新的 PersonalBaseToken
4. 复制令牌备用

## 📖 使用说明

### 基本操作流程

1. **授权设置**
   - 输入多维表格的 Base ID（从 URL 中获取）
   - 输入 PersonalBaseToken
   - 点击"测试授权"确认权限

2. **选择表格**
   - 从下拉菜单选择源表格
   - 选择目标表格
   - 系统自动加载表格列表

3. **字段映射**
   - 默认使用自动匹配（同名字段）
   - 支持手动选择复制字段（可选）

4. **数据复制**
   - 可先使用"测试单条复制"验证
   - 点击"开始复制"进行批量复制
   - 实时监控复制进度

### 调试工具

- **🔍 调试源表数据** - 分析源表的字段结构和数据样本
- **🔍 调试字段匹配** - 检查字段映射关系和类型兼容性
- **🧪 测试单条复制** - 验证数据转换逻辑

## ⚙️ 技术特性

### 数据类型转换

自动处理常见字段类型转换：

- **文本字段** (type=1) → `String(value)`
- **数字字段** (type=2) → `Number(value)`
- **单选字段** (type=3) → `String(value)`
- **多选字段** (type=4) → 数组处理
- **日期字段** (type=5) → 保持原格式

### 错误处理

完善的错误处理机制：

- **sc=13** - 字段值被丢弃（类型不匹配）
- **sc=21** - 字段格式错误
- **sc=30** - 字段操作失败
- 网络超时和频率限制处理

### 性能优化

- 分页获取大量数据（每页100条）
- 批量写入时添加延迟避免频率限制
- 只传输有效字段，跳过空值

## 🎨 UI 设计

- **配色方案**: 浅灰背景 (#f5f7fa) + 深蓝强调色 (#1e40af)
- **设计风格**: 卡片式模块，统一6-8px圆角
- **字体系统**: -apple-system, "Segoe UI" 等系统字体
- **交互反馈**: 渐变按钮，悬停动画，实时状态更新

## 🔧 开发说明

### API 接口

所有API均使用POST方法，标准JSON格式：

```javascript
// 请求格式
{
  "baseId": "KnX9bIOTKaE3trspPCycfFMjnkg",
  "personalToken": "pt-xxx",
  "sourceTableId": "tbl123",
  "targetTableId": "tbl456"
}

// 响应格式
{
  "success": true,
  "data": {...},
  "error": "错误信息"
}
```

### 核心依赖

- `@lark-base-open/node-sdk` - 飞书 SDK
- `vercel` - 部署平台

## 🚀 部署

### Vercel 部署

1. 推送代码到 GitHub
2. 在 Vercel 中导入项目
3. 自动部署完成

### 其他平台

支持任何支持 Node.js 的云平台部署。

## 🐛 常见问题

### Q: 复制后目标表为空？
A: 检查字段类型匹配，使用调试工具分析数据结构。

### Q: 授权失败？
A: 确认 PersonalBaseToken 有效，BaseId 格式正确。

### Q: 复制速度慢？
A: 大量数据正常，系统有频率限制保护机制。

## 📄 更新日志

### v2.0.0 (2025-01-16)
- ✅ 完整的数据类型转换系统
- ✅ 现代化卡片式UI设计
- ✅ 完善的调试工具套件
- ✅ 优化的错误处理机制
- ✅ 项目结构清理和优化

### v1.0.0 (初始版本)
- 基础的表格复制功能
- PersonalBaseToken 认证
- 简单的字段映射

## 📞 技术支持

如有问题请检查：
1. 控制台日志输出
2. 使用内置调试工具
3. 确认网络连接稳定
4. 验证权限设置正确

---

**🎉 项目已完成核心功能开发和测试，可用于生产环境！**
