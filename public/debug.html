<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>è°ƒè¯•é¡µé¢</title>
  <style>
    body { font-family: Arial; margin: 20px; }
    input, button { width: 100%; padding: 8px; margin: 4px 0; }
    #log { white-space: pre-wrap; background: #f5f5f5; padding: 10px; border: 1px solid #ddd; }
  </style>
</head>
<body>
  <h3>è°ƒè¯•é¡µé¢</h3>
  
  <h4>1. æµ‹è¯•æˆæƒ</h4>
  <input id="baseId" placeholder="Base ID" value="KnX9bIOTKaE3trspPCycfFMjnkg" />
  <input id="token" placeholder="PersonalBaseToken" type="password" />
  <button onclick="testAuth()">æµ‹è¯•æˆæƒ</button>
  
  <h4>2. å¤åˆ¶æ•°æ®</h4>
  <input id="source" placeholder="æºè¡¨ ID" />
  <input id="target" placeholder="ç›®æ ‡è¡¨ ID" />
  <button onclick="testCopy()">æµ‹è¯•å¤åˆ¶</button>
  
  <h4>æ—¥å¿—</h4>
  <pre id="log"></pre>

  <script>
    function log(message) {
      const logEl = document.getElementById('log');
      const time = new Date().toLocaleTimeString();
      logEl.textContent += `[${time}] ${message}\n`;
      logEl.scrollTop = logEl.scrollHeight;
    }

    async function testAuth() {
      const baseId = document.getElementById('baseId').value;
      const token = document.getElementById('token').value;
      
      if (!baseId || !token) {
        return log('â— è¯·å¡«å†™BaseIdå’ŒToken');
      }

      log('ğŸ” æµ‹è¯•æˆæƒ...');
      
      try {
        const res = await fetch('/api/test-auth', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ baseId, personalToken: token })
        });
        
        const data = await res.json();
        log(`æˆæƒç»“æœ: ${JSON.stringify(data, null, 2)}`);
      } catch (e) {
        log(`âŒ é”™è¯¯: ${e.message}`);
      }
    }

    async function testCopy() {
      const baseId = document.getElementById('baseId').value;
      const token = document.getElementById('token').value;
      const source = document.getElementById('source').value;
      const target = document.getElementById('target').value;
      
      if (!baseId || !token || !source || !target) {
        return log('â— è¯·å¡«å†™æ‰€æœ‰å­—æ®µ');
      }

      log('ğŸš€ æµ‹è¯•å¤åˆ¶...');
      
      try {
        const res = await fetch('/api/copy', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ 
            baseId, 
            personalToken: token,
            sourceTableId: source,
            targetTableId: target
          })
        });
        
        const data = await res.json();
        log(`å¤åˆ¶ç»“æœ: ${JSON.stringify(data, null, 2)}`);
      } catch (e) {
        log(`âŒ é”™è¯¯: ${e.message}`);
      }
    }
  </script>
</body>
</html>